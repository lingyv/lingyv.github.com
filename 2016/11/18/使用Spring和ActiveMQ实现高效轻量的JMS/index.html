<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="lingyv" />



<meta name="description" content="官方推荐的文章，原文">
<meta property="og:type" content="article">
<meta property="og:title" content="使用Spring和ActiveMQ实现高效轻量的JMS">
<meta property="og:url" content="http://lingyv.cn/2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/index.html">
<meta property="og:site_name" content="凌宇">
<meta property="og:description" content="官方推荐的文章，原文">
<meta property="og:updated_time" content="2016-11-17T09:33:12.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用Spring和ActiveMQ实现高效轻量的JMS">
<meta name="twitter:description" content="官方推荐的文章，原文">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternative" href="/atom.xml" title="凌宇" type="application/atom+xml">



    <link rel="shortcut icon" href="/images/zhandian.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>使用Spring和ActiveMQ实现高效轻量的JMS | 凌宇</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: true,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>





    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?d8d2884d34e07cc018d380d28cc6a73c";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/images/touxiang.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">lingyv</a></h1>
        </hgroup>

        
        <p class="header-subtitle">lingyv</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="/lingyv@gmail.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/5051531692/profile?topnav=1&wvr=6&is_all=1" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/lingyv" title="GitHub"></a>
                            
                                <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/lingyv" title="知乎"></a>
                            
                                <a class="fa 简书" target="_blank" href="http://www.jianshu.com/users/999835d02088/latest_articles" title="简书"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ActiveMQ/">ActiveMQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatis/">MyBatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Validator/">Validator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Velocity/">Velocity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/官方文档/">官方文档</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/教程/">教程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编程/">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/翻译/">翻译</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">Java &amp; Python</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">lingyv</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/images/touxiang.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">lingyv</a></h1>
            </hgroup>
            
            <p class="header-subtitle">lingyv</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="/lingyv@gmail.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/5051531692/profile?topnav=1&wvr=6&is_all=1" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/lingyv" title="GitHub"></a>
                            
                                <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/lingyv" title="知乎"></a>
                            
                                <a class="fa 简书" target="_blank" href="http://www.jianshu.com/users/999835d02088/latest_articles" title="简书"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-使用Spring和ActiveMQ实现高效轻量的JMS" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/" class="article-date">
      <time datetime="2016-11-18T11:49:29.000Z" itemprop="datePublished">2016-11-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      使用Spring和ActiveMQ实现高效轻量的JMS
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/术/">术</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ActiveMQ/">ActiveMQ</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分布式/">分布式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/官方文档/">官方文档</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>官方推荐的文章，<a href="http://codedependents.com/2009/10/16/efficient-lightweight-jms-with-spring-and-activemq/" target="_blank" rel="external">原文</a><br><a id="more"></a><br>Asynchronicity, its the <a href="http://highscalability.com/blog/2009/10/7/how-to-avoid-the-top-5-scale-out-pitfalls.html" target="_blank" rel="external">number one</a> <a href="http://highscalability.com/blog/2009/8/11/13-scalability-best-practices.html" target="_blank" rel="external">design</a> <a href="http://highscalability.com/blog/2009/5/8/eight-best-practices-for-building-scalable-systems.html" target="_blank" rel="external">principal</a> for highly scalable systems, and for Java that means <a href="http://java.sun.com/products/jms/" target="_blank" rel="external">JMS</a>, which in turn means <a href="http://activemq.apache.org/" target="_blank" rel="external">ActiveMQ</a>. But <a href="http://activemq.apache.org/how-do-i-use-jms-efficiently.html" target="_blank" rel="external">how do I use JMS efficiently</a>? One can quickly  become overwhelmed with talk of containers, frameworks, and a plethora of options, most of which are outdated. So lets pick it apart.</p>
<p>异步性，是高伸缩性系统的首要的设计原则，对Java来说，这意味着JMS和ActiveMQ。但是我应该如何高效的使用JMS呢？在谈论容器、框架、和一堆选项时，你可能会不知所措。所以，让我们分开来探讨下吧。</p>
<h1 id="Frameworks-框架"><a href="#Frameworks-框架" class="headerlink" title="Frameworks 框架"></a>Frameworks 框架</h1><p>The ActiveMQ documentation makes mention of two frameworks; <a href="http://camel.apache.org/" target="_blank" rel="external">Camel</a> and <a href="http://www.springsource.org/about" target="_blank" rel="external">Spring</a>. The decision here comes down to simplicity vs functionality. Camel supports an immense amount of <a href="http://en.wikipedia.org/wiki/Enterprise_Integration_Patterns" target="_blank" rel="external">Enterprise Integration Patterns</a> that can greatly simplify integrating a variety of services and orchestrating complicated message flows between components. Its certainly a best of breed if your system requires such functionality. However, if you are looking for simplicity and support for the basic best practices then Spring has the upper hand. For me, simplicity wins out any day of the week.</p>
<p>ActiveMQ文档中提及两个框架：Camel和Spring。那么如何做决定就取决于简单性和功能性的对比。Camel支持大量的企业集成模式，它可以大大简化集成组件间的大量服务和复杂的消息流。如果你的系统需要这样的功能，它当然是非常好的选择。然而，如果你寻找简单性，仅仅支持基本的最佳实践，那么Spring是好的选择。</p>
<h1 id="JCA-Use-It-Or-Loose-It"><a href="#JCA-Use-It-Or-Loose-It" class="headerlink" title="JCA (Use It Or Loose It)"></a>JCA (Use It Or Loose It)</h1><p>Reading through ActiveMQ’s <a href="http://activemq.apache.org/spring-support.html" target="_blank" rel="external">spring support</a> one is instantly introduced to the idea of a <a href="http://java.sun.com/j2ee/connector/" target="_blank" rel="external">JCA</a> container and ActiveMQ’s various proxies and <a href="http://activemq.apache.org/resource-adapter.html" target="_blank" rel="external">adaptors</a> for working inside of one. However, this is all a red herring. JCA is part of the EJB specification and as with most of the <a href="http://java.sun.com/products/ejb/" target="_blank" rel="external">EJB</a> specification, Spring doesn’t support it. Then there is a mention of <a href="http://docs.codehaus.org/display/JCA/Home" target="_blank" rel="external">Jencks</a>, a “lightweight JCA container for Spring”, which was spun off of ActiveMQ’s <a href="http://activemq.apache.org/jca-container.html" target="_blank" rel="external">JCA container</a>. At first this seems like the ideal solution, but let me stop you there.  Jencks was last updated on January 3rd 2007. At that time ActiveMQ was at version 4.1.x and Spring was at version 2.0.x and things have come a long way, a very long way. Even trying to get Jencks from the maven repository fails due to dependencies on ActiveMQ 4.1.x jars that no longer exist. The simple fact is there are better and simpler ways to ensure resource caching.</p>
<p>阅读ActiveMQ的Spring支持时，开发者立刻被介绍了JCA容器和ActiveMQ很多的代理和适配器选项的概念。然而这些都不适应。JCA是EJB规范的一部分，对于大部分EJB规范，Spring都没有提供很好的支持。这时，就提到了Jencks，<code>为Spring提供的轻量级JCA容器</code>，它可以作为ActiveMQ的JCA容器。 乍看上去，这是个非常好的解决方案，但是我在这里告诉你不要这样做。Jencks最后更新时间是2007年1月。那时ActiveMQ的版本是 4.1x，Spring的版本是2.0.x，但是时间过了很多，事情也变化了很大。甚至是试图从Maven库中获取ActiveMQ4.1的依赖包 Jencks都会失败，因为它已经不存在了。简单的事实是有更好和更简单的方式来缓存资源。</p>
<h1 id="Sending-Messages-发送消息"><a href="#Sending-Messages-发送消息" class="headerlink" title="Sending Messages 发送消息"></a>Sending Messages 发送消息</h1><p>The core of Spring’s message sending architecture is the <a href="http://static.springsource.org/spring/docs/2.5.6/api/org/springframework/jms/core/JmsTemplate.html" target="_blank" rel="external">JmsTemplate</a>. In typical Spring template fashion, the JmsTemplate abstracts away all the cruft of opening and closing sessions and producers so all the application developer needs to worry about is the actual business logic. However, ActiveMQ is quick to point out the <a href="http://activemq.apache.org/jmstemplate-gotchas.html" target="_blank" rel="external">JmsTemplate gotchas</a>, mostly that JmsTemplate is designed to open and close the session and producer on each call. To prevent this from absolutely destroying the messaging performance the documentation recommends using ActiveMQ’s <a href="http://activemq.apache.org/maven/activemq-pool/apidocs/org/apache/activemq/pool/PooledConnectionFactory.html" target="_blank" rel="external">PooledConnectionFactory</a> which caches the sessions and message producers. However this too is outdated. Starting with version 2.5.3, Spring started shipping its own <a href="http://static.springsource.org/spring/docs/2.5.6/api/org/springframework/jms/connection/CachingConnectionFactory.html" target="_blank" rel="external">CachingConnectionFactory</a> which I believe to be the preferred caching method. (UPDATE: In <a href="https://codedependents.com/2010/03/04/synchronous-request-response-with-activemq-and-spring/" target="_blank" rel="external">my more recent post</a>, I talk about when you might want to use PooledConnectionFactory.) However, there is one catch to point out. By default the CachingConnectionFactory only caches one session which the javadoc claims to <a href="http://static.springsource.org/spring/docs/2.5.6/api/org/springframework/jms/connection/CachingConnectionFactory.html#setSessionCacheSize(int" target="_blank" rel="external">be sufficient for low concurrency situations</a>). By contrast, the PooledConnectionFactory <a href="http://www.docjar.com/html/api/org/apache/activemq/pool/PooledConnectionFactory.java.html" target="_blank" rel="external">defaults to 500</a>. As with most settings of this type, some amount of experimentation is probably in order. I’ve started with 100 which seems like a good compromise.</p>
<p>Spring消息发送的核心架构是JmsTemplate。在传统的Spring模板方式中，JmsTemplate隔离了像打开、关闭Session和Producer的繁琐操作，因此应用开发人员仅仅需要关注实际的业务逻辑。然而ActiveMQ快速的指出了JmsTemplate gotchas，大多是因为JmsTemplate被设计在每次调用时都打开和关闭session及producer。JmsTemplate损害了ActiveMQ的PooledConnectionFactory对session和消息producer的缓存机制而带来的性能提升。然而，这个太过时了。从Spring2.5.3开始，它开始提供自己的CachingConnectionFactory，我相信该类在缓存方面更加强大。然而，这里有一个点需要注意。默认情况下，CachingConnectionFactory只缓存一个session，在它的JavaDoc中，它声明对于低并发情况下这是足够的。与之相反，PooledConnectionFactory的默认值是500。这些设置，在很多情况下，需要亲自去测试并验证。我将其设置为100，对我来说还是很不错。</p>
<h1 id="Receiving-Messages-接收消息"><a href="#Receiving-Messages-接收消息" class="headerlink" title="Receiving Messages 接收消息"></a>Receiving Messages 接收消息</h1><p>As you may have noticed, the <a href="http://activemq.apache.org/jmstemplate-gotchas.html" target="_blank" rel="external">JmsTemplate gotchas</a> strongly discourages using the recieve() call on the JmsTemplate, again, since there is no pooling of sessions and consumers.  Moreover, all calls on the JmsTemplate are synchronous which means the calling thread will block until the method returns. This is fine when using JmsTemplate to send messages since the method returns almost instantly. However, when using the recieve() call, the thread will block until a message is received, which has a huge impact on performance. Unfortunately, neither the <a href="http://activemq.apache.org/jmstemplate-gotchas.html" target="_blank" rel="external">JmsTemplate gotchas</a> nor the <a href="http://activemq.apache.org/spring-support.html" target="_blank" rel="external">spring support</a> documentation mentions the simple Spring solution for these problems. In fact they both recommend using <a href="http://docs.codehaus.org/display/JCA/Home" target="_blank" rel="external">Jencks</a>, which we already debunked. The actual solution, using the <a href="http://static.springsource.org/spring/docs/2.5.x/api/org/springframework/jms/listener/DefaultMessageListenerContainer.html" target="_blank" rel="external">DefaultMessageListenerContainer</a>, is buried in the <a href="http://activemq.apache.org/how-do-i-use-jms-efficiently.html" target="_blank" rel="external">how do I use JMS efficiently</a> documentation. The DefaultMessageListenerContainer allows for the asynchronous receipt of messages as well as caching sessions and message consumers. Even more interesting, the DefaultMessageListenerContainer can dynamically grow and shrink the number of listeners based on message volume. In short, this is why we can completely ignore JCA.</p>
<p>Spring消息发送的核心架构是JmsTemplate。在传统的Spring模板方式中，JmsTemplate隔离了像打开、关闭Session和Producer的繁琐操作，因此应用开发人员仅仅需要关注实际的业务逻辑。然而ActiveMQ快速的指出了JmsTemplate gotchas，大多是因为JmsTemplate被设计在每次调用时都打开和关闭session及producer。JmsTemplate损害了ActiveMQ的PooledConnectionFactory对session和消息producer的缓存机制而带来的性能提升。然而，这个太过时了。从Spring2.5.3开始，它开始提供自己的CachingConnectionFactory，我相信该类在缓存方面更加强大。然而，这里有一个点需要注意。默认情况下，CachingConnectionFactory只缓存一个session，在它的JavaDoc中，它声明对于低并发情况下这是足够的。与之相反，PooledConnectionFactory的默认值是500。这些设置，在很多情况下，需要亲自去测试并验证。我将其设置为100，对我来说还是很不错。</p>
<h1 id="Putting-It-All-Together-合并起来"><a href="#Putting-It-All-Together-合并起来" class="headerlink" title="Putting It All Together 合并起来"></a>Putting It All Together 合并起来</h1><h2 id="SPRING-CONTEXT-XML"><a href="#SPRING-CONTEXT-XML" class="headerlink" title="SPRING CONTEXT XML"></a>SPRING CONTEXT XML</h2><p>Spring Context配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">xmlns:amq=&quot;http://activemq.apache.org/schema/core&quot;</div><div class="line">xmlns:jms=&quot;http://www.springframework.org/schema/jms&quot;</div><div class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</div><div class="line">xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</div><div class="line">http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core-5.2.0.xsd</div><div class="line">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd</div><div class="line">http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms-2.5.xsd&quot;&gt;</div><div class="line"></div><div class="line">&lt;!-- enables annotation based configuration --&gt;</div><div class="line">&lt;context:annotation-config /&gt;</div><div class="line">&lt;!-- scans for annotated classes in the com.company package --&gt;</div><div class="line">&lt;context:component-scan base-package=&quot;com.company&quot;/&gt;</div><div class="line">&lt;!-- allows for $&#123;&#125; replacement in the spring xml configuration from the system.properties file on the classpath --&gt;</div><div class="line">&lt;context:property-placeholder location=&quot;classpath:system.properties&quot;/&gt;</div><div class="line">&lt;!-- creates an activemq connection factory using the amq namespace --&gt;</div><div class="line">&lt;amq:connectionFactory id=&quot;amqConnectionFactory&quot; brokerURL=&quot;$&#123;jms.url&#125;&quot; userName=&quot;$&#123;jms.username&#125;&quot; password=&quot;$&#123;jms.password&#125;&quot; /&gt;</div><div class="line">&lt;!-- CachingConnectionFactory Definition, sessionCacheSize property is the number of sessions to cache --&gt;</div><div class="line">&lt;bean id=&quot;connectionFactory&quot; class=&quot;org.springframework.jms.connection.CachingConnectionFactory&quot;&gt;</div><div class="line">    &lt;constructor-arg ref=&quot;amqConnectionFactory&quot; /&gt;</div><div class="line">    &lt;property name=&quot;exceptionListener&quot; ref=&quot;jmsExceptionListener&quot; /&gt;</div><div class="line">    &lt;property name=&quot;sessionCacheSize&quot; value=&quot;100&quot; /&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line">&lt;!-- JmsTemplate Definition --&gt;</div><div class="line">&lt;bean id=&quot;jmsTemplate&quot; class=&quot;org.springframework.jms.core.JmsTemplate&quot;&gt;</div><div class="line">   &lt;constructor-arg ref=&quot;connectionFactory&quot;/&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line">&lt;!-- listener container definition using the jms namespace, concurrency is the max number of concurrent listeners that can be started --&gt;</div><div class="line">&lt;jms:listener-container concurrency=&quot;10&quot; &gt;</div><div class="line">    &lt;jms:listener id=&quot;QueueListener&quot; destination=&quot;Queue.Name&quot; ref=&quot;queueListener&quot; /&gt;</div><div class="line">&lt;/jms:listener-container&gt;</div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure></p>
<p>There are two things to notice here. First, I’ve added the amq and jms namespaces to the opening beans tag. Second, I’m using the Spring 2.5 <a href="http://static.springsource.org/spring/docs/2.5.x/reference/beans.html#beans-annotation-config" target="_blank" rel="external">annotation based configuration</a>. By using the annotation based configuration I can simply add <a href="http://static.springsource.org/spring/docs/2.5.x/api/org/springframework/stereotype/Component.html" target="_blank" rel="external">@Component</a> annotation to my Java classes instead of having to specify them in the spring context xml explicitly. Additionally, I can add <a href="http://static.springsource.org/spring/docs/2.5.x/api/org/springframework/beans/factory/annotation/Autowired.html" target="_blank" rel="external">@Autowired</a> on my constructors to have objects such as JmsTemplate automatically wired into my objects.</p>
<p>这里有两点需要注意。首先，我添加了amq和jms的命名空间。第二，我使用了Spring2.5的基于注解的配置。通过使用基于注解的配置，我可以简单的添加@Component注解到我的Java类上，而不是使用XML文件显式的在spring配置文件中定义它们。另外，我可以在我的构造方法中使用@Autowired来将像JmsTemplate这样的对象注入到我的对象中。</p>
<h2 id="QUEUESENDER"><a href="#QUEUESENDER" class="headerlink" title="QUEUESENDER"></a>QUEUESENDER</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">package com.company;</div><div class="line"></div><div class="line">import org.springframework.beans.factory.annotation.Autowired;</div><div class="line">import org.springframework.jms.core.JmsTemplate;</div><div class="line">import org.springframework.stereotype.Component;</div><div class="line"></div><div class="line">@Component</div><div class="line">public class QueueSender</div><div class="line">&#123;</div><div class="line">    private final JmsTemplate jmsTemplate;</div><div class="line"></div><div class="line">    @Autowired</div><div class="line">    public QueueSender( final JmsTemplate jmsTemplate )</div><div class="line">    &#123;</div><div class="line">        this.jmsTemplate = jmsTemplate;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void send( final String message )</div><div class="line">    &#123;</div><div class="line">        jmsTemplate.convertAndSend( &quot;Queue.Name&quot;, message );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="QUEUE-LISTENER"><a href="#QUEUE-LISTENER" class="headerlink" title="QUEUE LISTENER"></a>QUEUE LISTENER</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">package com.company;</div><div class="line"></div><div class="line">import javax.jms.JMSException;</div><div class="line">import javax.jms.Message;</div><div class="line">import javax.jms.MessageListener;</div><div class="line">import javax.jms.TextMessage;</div><div class="line"></div><div class="line">import org.springframework.stereotype.Component;</div><div class="line"></div><div class="line">@Component</div><div class="line">public class QueueListener implements MessageListener</div><div class="line">&#123;</div><div class="line">    public void onMessage( final Message message )</div><div class="line">    &#123;</div><div class="line">        if ( message instanceof TextMessage )</div><div class="line">        &#123;</div><div class="line">            final TextMessage textMessage = (TextMessage) message;</div><div class="line">            try</div><div class="line">            &#123;</div><div class="line">                System.out.println( textMessage.getText() );</div><div class="line">            &#125;</div><div class="line">            catch (final JMSException e)</div><div class="line">            &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##　JMSEXCEPTIONLISTENER<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">package com.company;</div><div class="line"></div><div class="line">import javax.jms.ExceptionListener;</div><div class="line">import javax.jms.JMSException;</div><div class="line"></div><div class="line">import org.springframework.stereotype.Component;</div><div class="line"></div><div class="line">@Component</div><div class="line">public class JmsExceptionListener implements ExceptionListener</div><div class="line">&#123;</div><div class="line">    public void onException( final JMSException e )</div><div class="line">    &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="Update-更新"><a href="#Update-更新" class="headerlink" title="Update 更新"></a>Update 更新</h1><p>I have finally updated the wiki at activemq.apache.org. The following pages now recommend using MessageListenerContainers and JmsTemplate with a Pooling ConnectionFactory instead of JCA and Jencks.</p>
<p>推荐查看下面的页面来使用带有池化连接池的MessageListenerContainer和JmsTemplate而不是JCA和Jencks。</p>
<ul>
<li><a href="http://activemq.apache.org/spring-support.html" target="_blank" rel="external">http://activemq.apache.org/spring-support.html</a></li>
<li><a href="http://activemq.apache.org/how-do-i-use-jms-efficiently.html" target="_blank" rel="external">http://activemq.apache.org/how-do-i-use-jms-efficiently.html</a></li>
<li><a href="http://activemq.apache.org/jmstemplate-gotchas.html" target="_blank" rel="external">http://activemq.apache.org/jmstemplate-gotchas.html</a></li>
</ul>
<p>译文参考:<a href="http://windows9834.blog.163.com/blog/static/27345004201311841121335/" target="_blank" rel="external">寒江的博客</a></p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/">使用Spring和ActiveMQ实现高效轻量的JMS</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">lingyv</a></p>
        <p><span>发布时间:</span>2016-11-18, 19:49:29</p>
        <p><span>最后更新:</span>2016-11-17, 17:33:12</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/" title="使用Spring和ActiveMQ实现高效轻量的JMS">http://lingyv.cn/2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/</a>
            <span class="copy-path" data-clipboard-text="原文: http://lingyv.cn/2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/　　作者: lingyv" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2016/11/18/ActiveMQ官方文档--Spring支持/">
                    ActiveMQ官方文档 -- Spring支持
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2016/11/17/ActiveMQ入门/">
                    ActiveMQ官方文档 -- 入门
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Frameworks-框架"><span class="toc-number">1.</span> <span class="toc-text">Frameworks 框架</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JCA-Use-It-Or-Loose-It"><span class="toc-number">2.</span> <span class="toc-text">JCA (Use It Or Loose It)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sending-Messages-发送消息"><span class="toc-number">3.</span> <span class="toc-text">Sending Messages 发送消息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Receiving-Messages-接收消息"><span class="toc-number">4.</span> <span class="toc-text">Receiving Messages 接收消息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Putting-It-All-Together-合并起来"><span class="toc-number">5.</span> <span class="toc-text">Putting It All Together 合并起来</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SPRING-CONTEXT-XML"><span class="toc-number">5.1.</span> <span class="toc-text">SPRING CONTEXT XML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#QUEUESENDER"><span class="toc-number">5.2.</span> <span class="toc-text">QUEUESENDER</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#QUEUE-LISTENER"><span class="toc-number">5.3.</span> <span class="toc-text">QUEUE LISTENER</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Update-更新"><span class="toc-number">6.</span> <span class="toc-text">Update 更新</span></a></li></ol>
</div>
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

<script>
    yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
</script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"使用Spring和ActiveMQ实现高效轻量的JMS　| 凌宇　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
      <div class="duoshuo" id="comments">
    <div id="comment-box" ></div>
    <div class="ds-thread" data-thread-key="2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/" data-title="使用Spring和ActiveMQ实现高效轻量的JMS" data-url="http://lingyv.cn/2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/"></div>
    <script>
        var duoshuoQuery = {short_name:"lingyv"};
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            s.async = true; s.charset = 'UTF-8';
            (d.head || d.body).appendChild(s);
        }

        
    </script>
    
    <script> loadComment(); </script>

</div>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/11/18/ActiveMQ官方文档--Spring支持/" title="上一篇: ActiveMQ官方文档 -- Spring支持">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2016/11/17/ActiveMQ入门/" title="下一篇: ActiveMQ官方文档 -- 入门">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/11/18/ActiveMQ官方文档--Spring支持/">ActiveMQ官方文档 -- Spring支持</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/">使用Spring和ActiveMQ实现高效轻量的JMS</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/17/ActiveMQ入门/">ActiveMQ官方文档 -- 入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/11/Hibernate Validator官方文档--第2章/">Hibernate Validator官方文档 -- 第2章</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/10/Hibernate Validator官方文档--第1章/">Hibernate Validator官方文档 -- 第1章</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/06/Velocity用户手册/">Velocity用户手册</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/02/springSecurity快速指南/">springSecurity快速指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/17/MyBatis官方文档--入门/">MyBatis官方文档 -- 入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/15/vim速查卡/">vim速查卡</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/13/Markdown语法/">Markdown语法</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/10/markdown快速入门/">Markdown快速入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/06/简明vim练级攻略/">简明 Vim 练级攻略(转)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/03/安装mongoDB/">安装mongoDB</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/01/绝对路径与相对路径/">Java--相对路径</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/20/RIME快速指南/">RIME快速指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/10/git快速指南/">Git快速指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/01/linux安装JDK/">linux安装JDK</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/27/Java知识点/">Java知识点(转)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/23/HotSpot虚拟机定位对象/">HotSpot虚拟机之定位对象</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/20/HotSpot虚拟机创建对象/">HotSpot虚拟机之创建对象</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/15/Java虚拟机内存/">JVM之内存</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/12/spf13-vim/">vim懒人福音--spf13-vim</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/09/二进制/">2的世界</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/08/采矿--编码与继电器/">采矿--编码与继电器</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/07/新入坑的程序猿们，一起去屠龙吧/">新入坑的程序猿们，一起去屠龙吧！</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/20/maven项目缓慢/">Maven项目创建缓慢解决方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/21/JDBC基础/">JDBC基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/08/Servlet工作原理3/">Servlet原理 三：Servlet体系结构以及工作原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/08/Servlet工作原理2/">Servlet原理 二：Web应用与创建Servlet实例</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/07/Servlet工作原理1/">Servlet原理 一：Servlet容器</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/06/zshshell/">Shell的唯一选择--zsh</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/05/Ubuntu15.4安装mac主题/">Ubuntu15.4安装mac主题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/05/vimium/">浏览器神器--Vimium</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/29/使用Hexo建立个人博客/">使用Hexo建立个人博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/29/浅谈Http请求与响应/">Http请求与响应</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016 lingyv
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.0">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >本站到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>




<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>