<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="ActiveMQ,分布式,Java,翻译," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="官方推荐的文章，原文">
<meta property="og:type" content="article">
<meta property="og:title" content="使用Spring和ActiveMQ实现高效轻量的JMS">
<meta property="og:url" content="http://lingyv.cn/2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/index.html">
<meta property="og:site_name" content="凌宇">
<meta property="og:description" content="官方推荐的文章，原文">
<meta property="og:updated_time" content="2016-11-18T15:08:12.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用Spring和ActiveMQ实现高效轻量的JMS">
<meta name="twitter:description" content="官方推荐的文章，原文">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://lingyv.cn/2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/"/>





  <title> 使用Spring和ActiveMQ实现高效轻量的JMS | 凌宇 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?d8d2884d34e07cc018d380d28cc6a73c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">凌宇</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">lingyv</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-dao">
          <a href="/categories/道/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-road"></i> <br />
            
            道
          </a>
        </li>
      
        
        <li class="menu-item menu-item-skill">
          <a href="/categories/术/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-map-signs"></i> <br />
            
            术
          </a>
        </li>
      
        
        <li class="menu-item menu-item-reprint">
          <a href="/categories/转/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-map-o"></i> <br />
            
            转
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://lingyv.cn/2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="lingyv">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/touxiang.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="凌宇">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="凌宇" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                使用Spring和ActiveMQ实现高效轻量的JMS
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-18T19:49:29+08:00">
                2016-11-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/术/" itemprop="url" rel="index">
                    <span itemprop="name">术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>官方推荐的文章，<a href="http://codedependents.com/2009/10/16/efficient-lightweight-jms-with-spring-and-activemq/" target="_blank" rel="external">原文</a><br><a id="more"></a><br>Asynchronicity, its the <a href="http://highscalability.com/blog/2009/10/7/how-to-avoid-the-top-5-scale-out-pitfalls.html" target="_blank" rel="external">number one</a> <a href="http://highscalability.com/blog/2009/8/11/13-scalability-best-practices.html" target="_blank" rel="external">design</a> <a href="http://highscalability.com/blog/2009/5/8/eight-best-practices-for-building-scalable-systems.html" target="_blank" rel="external">principal</a> for highly scalable systems, and for Java that means <a href="http://java.sun.com/products/jms/" target="_blank" rel="external">JMS</a>, which in turn means <a href="http://activemq.apache.org/" target="_blank" rel="external">ActiveMQ</a>. But <a href="http://activemq.apache.org/how-do-i-use-jms-efficiently.html" target="_blank" rel="external">how do I use JMS efficiently</a>? One can quickly  become overwhelmed with talk of containers, frameworks, and a plethora of options, most of which are outdated. So lets pick it apart.</p>
<p>异步性，是高伸缩性系统的首要的设计原则，对Java来说，这意味着JMS和ActiveMQ。但是我应该如何高效的使用JMS呢？在谈论容器、框架、和一堆选项时，你可能会不知所措。所以，让我们分开来探讨下吧。</p>
<h1 id="Frameworks-框架"><a href="#Frameworks-框架" class="headerlink" title="Frameworks 框架"></a>Frameworks 框架</h1><p>The ActiveMQ documentation makes mention of two frameworks; <a href="http://camel.apache.org/" target="_blank" rel="external">Camel</a> and <a href="http://www.springsource.org/about" target="_blank" rel="external">Spring</a>. The decision here comes down to simplicity vs functionality. Camel supports an immense amount of <a href="http://en.wikipedia.org/wiki/Enterprise_Integration_Patterns" target="_blank" rel="external">Enterprise Integration Patterns</a> that can greatly simplify integrating a variety of services and orchestrating complicated message flows between components. Its certainly a best of breed if your system requires such functionality. However, if you are looking for simplicity and support for the basic best practices then Spring has the upper hand. For me, simplicity wins out any day of the week.</p>
<p>ActiveMQ文档中提及两个框架：Camel和Spring。那么如何做决定就取决于简单性和功能性的对比。Camel支持大量的企业集成模式，它可以大大简化集成组件间的大量服务和复杂的消息流。如果你的系统需要这样的功能，它当然是非常好的选择。然而，如果你寻找简单性，仅仅支持基本的最佳实践，那么Spring是好的选择。</p>
<h1 id="JCA-Use-It-Or-Loose-It"><a href="#JCA-Use-It-Or-Loose-It" class="headerlink" title="JCA (Use It Or Loose It)"></a>JCA (Use It Or Loose It)</h1><p>Reading through ActiveMQ’s <a href="http://activemq.apache.org/spring-support.html" target="_blank" rel="external">spring support</a> one is instantly introduced to the idea of a <a href="http://java.sun.com/j2ee/connector/" target="_blank" rel="external">JCA</a> container and ActiveMQ’s various proxies and <a href="http://activemq.apache.org/resource-adapter.html" target="_blank" rel="external">adaptors</a> for working inside of one. However, this is all a red herring. JCA is part of the EJB specification and as with most of the <a href="http://java.sun.com/products/ejb/" target="_blank" rel="external">EJB</a> specification, Spring doesn’t support it. Then there is a mention of <a href="http://docs.codehaus.org/display/JCA/Home" target="_blank" rel="external">Jencks</a>, a “lightweight JCA container for Spring”, which was spun off of ActiveMQ’s <a href="http://activemq.apache.org/jca-container.html" target="_blank" rel="external">JCA container</a>. At first this seems like the ideal solution, but let me stop you there.  Jencks was last updated on January 3rd 2007. At that time ActiveMQ was at version 4.1.x and Spring was at version 2.0.x and things have come a long way, a very long way. Even trying to get Jencks from the maven repository fails due to dependencies on ActiveMQ 4.1.x jars that no longer exist. The simple fact is there are better and simpler ways to ensure resource caching.</p>
<p>ActiveMQ的Spring支持文档，立即向开发者介绍了JCA容器和ActiveMQ的很多代理和适配器选项的概念，但这些都是不合适的。JCA是EJB规范的一部分，对于大部分EJB规范，Spring都没有提供很好的支持。这时，就提到了Jencks，<code>为Spring提供的轻量级JCA容器</code>，它可以作为ActiveMQ的JCA容器。 乍看上去，这是个非常好的解决方案，但是我在这里告诉你不要这样做。Jencks最后更新时间是2007年1月。那时ActiveMQ的版本是 4.1x，Spring的版本是2.0.x，但是随着时间的流逝，事情变化了很大。甚至试图从Maven库中获取Jencks都会失败，因为它的依赖包ActiveMQ4.1已经不存在了。简单的事实是有更好和更简单的方式来缓存资源。</p>
<h1 id="Sending-Messages-发送消息"><a href="#Sending-Messages-发送消息" class="headerlink" title="Sending Messages 发送消息"></a>Sending Messages 发送消息</h1><p>The core of Spring’s message sending architecture is the <a href="http://static.springsource.org/spring/docs/2.5.6/api/org/springframework/jms/core/JmsTemplate.html" target="_blank" rel="external">JmsTemplate</a>. In typical Spring template fashion, the JmsTemplate abstracts away all the cruft of opening and closing sessions and producers so all the application developer needs to worry about is the actual business logic. However, ActiveMQ is quick to point out the <a href="http://activemq.apache.org/jmstemplate-gotchas.html" target="_blank" rel="external">JmsTemplate gotchas</a>, mostly that JmsTemplate is designed to open and close the session and producer on each call. To prevent this from absolutely destroying the messaging performance the documentation recommends using ActiveMQ’s <a href="http://activemq.apache.org/maven/activemq-pool/apidocs/org/apache/activemq/pool/PooledConnectionFactory.html" target="_blank" rel="external">PooledConnectionFactory</a> which caches the sessions and message producers. However this too is outdated. Starting with version 2.5.3, Spring started shipping its own <a href="http://static.springsource.org/spring/docs/2.5.6/api/org/springframework/jms/connection/CachingConnectionFactory.html" target="_blank" rel="external">CachingConnectionFactory</a> which I believe to be the preferred caching method. (UPDATE: In <a href="https://codedependents.com/2010/03/04/synchronous-request-response-with-activemq-and-spring/" target="_blank" rel="external">my more recent post</a>, I talk about when you might want to use PooledConnectionFactory.) However, there is one catch to point out. By default the CachingConnectionFactory only caches one session which the javadoc claims to <a href="http://static.springsource.org/spring/docs/2.5.6/api/org/springframework/jms/connection/CachingConnectionFactory.html#setSessionCacheSize(int" target="_blank" rel="external">be sufficient for low concurrency situations</a>). By contrast, the PooledConnectionFactory <a href="http://www.docjar.com/html/api/org/apache/activemq/pool/PooledConnectionFactory.java.html" target="_blank" rel="external">defaults to 500</a>. As with most settings of this type, some amount of experimentation is probably in order. I’ve started with 100 which seems like a good compromise.</p>
<p>Spring发送消息的核心架构是JmsTemplate。在传统的Spring模板方式中，JmsTemplate隔离了像打开、关闭Session和Producer的繁琐操作，因此应用开发人员仅仅需要关注实际的业务逻辑。然而ActiveMQ快速的指出了JmsTemplate gotchas，大多是因为JmsTemplate被设计在每次调用时都打开和关闭session及producer。JmsTemplate损害了ActiveMQ的PooledConnectionFactory对session和消息producer的缓存机制而带来的性能提升。然而，这个太过时了。从Spring2.5.3开始，它开始提供自己的CachingConnectionFactory，我相信该类在缓存方面更加强大。然而，这里有一个点需要注意。默认情况下，CachingConnectionFactory只缓存一个session，在它的JavaDoc中，它声明对于低并发情况下这是足够的。与之相反，PooledConnectionFactory的默认值是500。这些设置，在很多情况下，需要亲自去测试并验证。我将其设置为100，对我来说还是很不错。</p>
<h1 id="Receiving-Messages-接收消息"><a href="#Receiving-Messages-接收消息" class="headerlink" title="Receiving Messages 接收消息"></a>Receiving Messages 接收消息</h1><p>As you may have noticed, the <a href="http://activemq.apache.org/jmstemplate-gotchas.html" target="_blank" rel="external">JmsTemplate gotchas</a> strongly discourages using the recieve() call on the JmsTemplate, again, since there is no pooling of sessions and consumers.  Moreover, all calls on the JmsTemplate are synchronous which means the calling thread will block until the method returns. This is fine when using JmsTemplate to send messages since the method returns almost instantly. However, when using the recieve() call, the thread will block until a message is received, which has a huge impact on performance. Unfortunately, neither the <a href="http://activemq.apache.org/jmstemplate-gotchas.html" target="_blank" rel="external">JmsTemplate gotchas</a> nor the <a href="http://activemq.apache.org/spring-support.html" target="_blank" rel="external">spring support</a> documentation mentions the simple Spring solution for these problems. In fact they both recommend using <a href="http://docs.codehaus.org/display/JCA/Home" target="_blank" rel="external">Jencks</a>, which we already debunked. The actual solution, using the <a href="http://static.springsource.org/spring/docs/2.5.x/api/org/springframework/jms/listener/DefaultMessageListenerContainer.html" target="_blank" rel="external">DefaultMessageListenerContainer</a>, is buried in the <a href="http://activemq.apache.org/how-do-i-use-jms-efficiently.html" target="_blank" rel="external">how do I use JMS efficiently</a> documentation. The DefaultMessageListenerContainer allows for the asynchronous receipt of messages as well as caching sessions and message consumers. Even more interesting, the DefaultMessageListenerContainer can dynamically grow and shrink the number of listeners based on message volume. In short, this is why we can completely ignore JCA.</p>
<p>可能你已经注意了，JmsTemplate gotchas非常不建议你使用JmsTemplate的receive()调用，同样也是因为没有session和consumer的池机制。更多的原因是在JmsTemplate上的所有调用都是同步的，这意味着调用线程需要被阻塞，直到方法返回。这在使用JmsTemplate发送消息时，没有任何问题， 因为该方法几乎是立即返回。然而，当调用receive方法时，线程将阻塞，直到接收到一个消息为止，这对性能影响很大。不幸的是，JmsTemplate gotchas和Spring支持文档中都没有对该问题提供简单的解决方案。实际上，它们均提倡使用Jencks，我们之前已经说过。实际的解决方案，使用DefaultMessageListenerContainer，已经写在了how do I use JMS efficiently文档中。DefaultMessageListenerContainer允许异步接收消息并缓存session和消息consumer。更有趣的是，DefaultMessageListenerContainer可以根据消息数量动态的增加或缩减监听器的数量。简而言之，我们可以完全忽视 JCA。</p>
<h1 id="Putting-It-All-Together-合并起来"><a href="#Putting-It-All-Together-合并起来" class="headerlink" title="Putting It All Together 合并起来"></a>Putting It All Together 合并起来</h1><h2 id="SPRING-CONTEXT-XML"><a href="#SPRING-CONTEXT-XML" class="headerlink" title="SPRING CONTEXT XML"></a>SPRING CONTEXT XML</h2><p>Spring Context配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">xmlns:amq=&quot;http://activemq.apache.org/schema/core&quot;</div><div class="line">xmlns:jms=&quot;http://www.springframework.org/schema/jms&quot;</div><div class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</div><div class="line">xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</div><div class="line">http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core-5.2.0.xsd</div><div class="line">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd</div><div class="line">http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms-2.5.xsd&quot;&gt;</div><div class="line"></div><div class="line">&lt;!-- enables annotation based configuration --&gt;</div><div class="line">&lt;context:annotation-config /&gt;</div><div class="line"></div><div class="line">&lt;!-- scans for annotated classes in the com.company package --&gt;</div><div class="line">&lt;context:component-scan base-package=&quot;com.company&quot;/&gt;</div><div class="line"></div><div class="line">&lt;!-- allows for $&#123;&#125; replacement in the spring xml configuration from the system.properties file on the classpath --&gt;</div><div class="line">&lt;context:property-placeholder location=&quot;classpath:system.properties&quot;/&gt;</div><div class="line"></div><div class="line">&lt;!-- creates an activemq connection factory using the amq namespace --&gt;</div><div class="line">&lt;amq:connectionFactory id=&quot;amqConnectionFactory&quot; brokerURL=&quot;$&#123;jms.url&#125;&quot; userName=&quot;$&#123;jms.username&#125;&quot; password=&quot;$&#123;jms.password&#125;&quot; /&gt;</div><div class="line"></div><div class="line">&lt;!-- CachingConnectionFactory Definition, sessionCacheSize property is the number of sessions to cache --&gt;</div><div class="line">&lt;bean id=&quot;connectionFactory&quot; class=&quot;org.springframework.jms.connection.CachingConnectionFactory&quot;&gt;</div><div class="line">    &lt;constructor-arg ref=&quot;amqConnectionFactory&quot; /&gt;</div><div class="line">    &lt;property name=&quot;exceptionListener&quot; ref=&quot;jmsExceptionListener&quot; /&gt;</div><div class="line">    &lt;property name=&quot;sessionCacheSize&quot; value=&quot;100&quot; /&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line"></div><div class="line">&lt;!-- JmsTemplate Definition --&gt;</div><div class="line">&lt;bean id=&quot;jmsTemplate&quot; class=&quot;org.springframework.jms.core.JmsTemplate&quot;&gt;</div><div class="line">   &lt;constructor-arg ref=&quot;connectionFactory&quot;/&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line"></div><div class="line">&lt;!-- listener container definition using the jms namespace, concurrency is the max number of concurrent listeners that can be started --&gt;</div><div class="line">&lt;jms:listener-container concurrency=&quot;10&quot; &gt;</div><div class="line">    &lt;jms:listener id=&quot;QueueListener&quot; destination=&quot;Queue.Name&quot; ref=&quot;queueListener&quot; /&gt;</div><div class="line">&lt;/jms:listener-container&gt;</div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure></p>
<p>There are two things to notice here. First, I’ve added the amq and jms namespaces to the opening beans tag. Second, I’m using the Spring 2.5 <a href="http://static.springsource.org/spring/docs/2.5.x/reference/beans.html#beans-annotation-config" target="_blank" rel="external">annotation based configuration</a>. By using the annotation based configuration I can simply add <a href="http://static.springsource.org/spring/docs/2.5.x/api/org/springframework/stereotype/Component.html" target="_blank" rel="external">@Component</a> annotation to my Java classes instead of having to specify them in the spring context xml explicitly. Additionally, I can add <a href="http://static.springsource.org/spring/docs/2.5.x/api/org/springframework/beans/factory/annotation/Autowired.html" target="_blank" rel="external">@Autowired</a> on my constructors to have objects such as JmsTemplate automatically wired into my objects.</p>
<p>这里有两点需要注意。首先，我添加了amq和jms的命名空间。第二，我使用了Spring2.5基于注解的配置。通过使用基于注解的配置，我可以简单的添加@Component注解到我的Java类上，而不是使用XML文件显式的在spring配置文件中定义它们。另外，我可以在我的构造方法中使用@Autowired来将像JmsTemplate这样的对象注入到我的对象中。</p>
<h2 id="QUEUESENDER"><a href="#QUEUESENDER" class="headerlink" title="QUEUESENDER"></a>QUEUESENDER</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">package com.company;</div><div class="line"></div><div class="line">import org.springframework.beans.factory.annotation.Autowired;</div><div class="line">import org.springframework.jms.core.JmsTemplate;</div><div class="line">import org.springframework.stereotype.Component;</div><div class="line"></div><div class="line">@Component</div><div class="line">public class QueueSender</div><div class="line">&#123;</div><div class="line">    private final JmsTemplate jmsTemplate;</div><div class="line"></div><div class="line">    @Autowired</div><div class="line">    public QueueSender( final JmsTemplate jmsTemplate )</div><div class="line">    &#123;</div><div class="line">        this.jmsTemplate = jmsTemplate;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void send( final String message )</div><div class="line">    &#123;</div><div class="line">        jmsTemplate.convertAndSend( &quot;Queue.Name&quot;, message );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="QUEUE-LISTENER"><a href="#QUEUE-LISTENER" class="headerlink" title="QUEUE LISTENER"></a>QUEUE LISTENER</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">package com.company;</div><div class="line"></div><div class="line">import javax.jms.JMSException;</div><div class="line">import javax.jms.Message;</div><div class="line">import javax.jms.MessageListener;</div><div class="line">import javax.jms.TextMessage;</div><div class="line"></div><div class="line">import org.springframework.stereotype.Component;</div><div class="line"></div><div class="line">@Component</div><div class="line">public class QueueListener implements MessageListener</div><div class="line">&#123;</div><div class="line">    public void onMessage( final Message message )</div><div class="line">    &#123;</div><div class="line">        if ( message instanceof TextMessage )</div><div class="line">        &#123;</div><div class="line">            final TextMessage textMessage = (TextMessage) message;</div><div class="line">            try</div><div class="line">            &#123;</div><div class="line">                System.out.println( textMessage.getText() );</div><div class="line">            &#125;</div><div class="line">            catch (final JMSException e)</div><div class="line">            &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##　JMSEXCEPTIONLISTENER<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">package com.company;</div><div class="line"></div><div class="line">import javax.jms.ExceptionListener;</div><div class="line">import javax.jms.JMSException;</div><div class="line"></div><div class="line">import org.springframework.stereotype.Component;</div><div class="line"></div><div class="line">@Component</div><div class="line">public class JmsExceptionListener implements ExceptionListener</div><div class="line">&#123;</div><div class="line">    public void onException( final JMSException e )</div><div class="line">    &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="Update-更新"><a href="#Update-更新" class="headerlink" title="Update 更新"></a>Update 更新</h1><p>I have finally updated the wiki at activemq.apache.org. The following pages now recommend using MessageListenerContainers and JmsTemplate with a Pooling ConnectionFactory instead of JCA and Jencks.</p>
<p>推荐查看下面的页面来使用带有池化连接池的MessageListenerContainer和JmsTemplate而不是JCA和Jencks。</p>
<ul>
<li><a href="http://activemq.apache.org/spring-support.html" target="_blank" rel="external">http://activemq.apache.org/spring-support.html</a></li>
<li><a href="http://activemq.apache.org/how-do-i-use-jms-efficiently.html" target="_blank" rel="external">http://activemq.apache.org/how-do-i-use-jms-efficiently.html</a></li>
<li><a href="http://activemq.apache.org/jmstemplate-gotchas.html" target="_blank" rel="external">http://activemq.apache.org/jmstemplate-gotchas.html</a></li>
</ul>
<p>译文参考:<a href="http://windows9834.blog.163.com/blog/static/27345004201311841121335/" target="_blank" rel="external">寒江的博客</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ActiveMQ/" rel="tag"># ActiveMQ</a>
          
            <a href="/tags/分布式/" rel="tag"># 分布式</a>
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/翻译/" rel="tag"># 翻译</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/18/代码重构之道/" rel="next" title="代码重构之道">
                <i class="fa fa-chevron-left"></i> 代码重构之道
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/11/19/写代码的四个境界/" rel="prev" title="写代码的四个境界">
                写代码的四个境界 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/"
     data-title="使用Spring和ActiveMQ实现高效轻量的JMS"
     data-content=""
     data-url="http://lingyv.cn/2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          

  <p>热评文章</p>
  <div class="ds-top-threads" data-range="weekly" data-num-items="4"></div>


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/"
           data-title="使用Spring和ActiveMQ实现高效轻量的JMS" data-url="http://lingyv.cn/2016/11/18/使用Spring和ActiveMQ实现高效轻量的JMS/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/touxiang.png"
               alt="lingyv" />
          <p class="site-author-name" itemprop="name">lingyv</p>
          <p class="site-description motion-element" itemprop="description">Opean Source</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">46</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/lingyv" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/lingyv" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-binoculars"></i>
                  
                  知乎
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/999835d02088/latest_articles" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-edit"></i>
                  
                  简书
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Frameworks-框架"><span class="nav-number">1.</span> <span class="nav-text">Frameworks 框架</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JCA-Use-It-Or-Loose-It"><span class="nav-number">2.</span> <span class="nav-text">JCA (Use It Or Loose It)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Sending-Messages-发送消息"><span class="nav-number">3.</span> <span class="nav-text">Sending Messages 发送消息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Receiving-Messages-接收消息"><span class="nav-number">4.</span> <span class="nav-text">Receiving Messages 接收消息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Putting-It-All-Together-合并起来"><span class="nav-number">5.</span> <span class="nav-text">Putting It All Together 合并起来</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SPRING-CONTEXT-XML"><span class="nav-number">5.1.</span> <span class="nav-text">SPRING CONTEXT XML</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QUEUESENDER"><span class="nav-number">5.2.</span> <span class="nav-text">QUEUESENDER</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QUEUE-LISTENER"><span class="nav-number">5.3.</span> <span class="nav-text">QUEUE LISTENER</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Update-更新"><span class="nav-number">6.</span> <span class="nav-text">Update 更新</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lingyv</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lingyv"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  


</body>
</html>
